<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>q3dfit.plot &mdash; q3dfit 1.1.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=00f267c6"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            q3dfit
          </a>
              <div class="version">
                1.1.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">q3dfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIR-configuration.html">MIR Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html">checkcomp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.contfit">contfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.cube_bin">cube_bin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.exceptions">q3dfit.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.fitloop">q3dfit.fitloop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.fitspec">q3dfit.fitspec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.gdtemp">q3dfit.gdtemp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.interp_temp_quest">q3dfit.interp_temp_quest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.interptemp">q3dfit.interptemp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.jnb">q3dfit.jnb</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.jwstlinez">q3dfit.jwstlinez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.lineinit">q3dfit.lineinit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.linelist">q3dfit.linelist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.masklin">q3dfit.masklin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#q3dfit-mk-npy-templ">q3dfit.mk_npy_templ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.nonJWST_datacube_converter">q3dfit.nonJWST_datacube_converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.observedlinez">q3dfit.observedlinez</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.plot">q3dfit.plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#q3dfit-psf-sub">q3dfit.psf_sub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3dcollect">q3dfit.q3dcollect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3df">q3dfit.q3df</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3df_helperFunctions">q3dfit.q3df_helperFunctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3din">q3dfit.q3din</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3dmath">q3dfit.q3dmath</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3dout">q3dfit.q3dout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3dpro">q3dfit.q3dpro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.q3dutil">q3dfit.q3dutil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.qsohostfcn">q3dfit.qsohostfcn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.questfitfcn">q3dfit.questfitfcn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.readcube">q3dfit.readcube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.readtemp">q3dfit.readtemp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.rebin">q3dfit.rebin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.restline">q3dfit.restline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#q3dfit-sdi">q3dfit.sdi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.select_spaxels">q3dfit.select_spaxels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.spectConvol">q3dfit.spectConvol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit.writeout_quest">q3dfit.writeout_quest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/q3dfit.html#module-q3dfit">Module contents</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">q3dfit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">q3dfit.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for q3dfit.plot</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">q3dfit.q3dmath</span> <span class="kn">import</span> <span class="n">cmplin</span>
<span class="kn">from</span> <span class="nn">q3dfit.q3dutil</span> <span class="kn">import</span> <span class="n">lmlabel</span>
<span class="kn">from</span> <span class="nn">q3dfit.exceptions</span> <span class="kn">import</span> <span class="n">InitializationError</span>
<span class="kn">from</span> <span class="nn">q3dfit.questfitfcn</span> <span class="kn">import</span> <span class="n">readcf</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>


<div class="viewcode-block" id="plotcont">
<a class="viewcode-back" href="../../source/q3dfit.html#q3dfit.plot.plotcont">[docs]</a>
<span class="k">def</span> <span class="nf">plotcont</span><span class="p">(</span><span class="n">q3do</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ct_coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q3di</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">compspec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comptitles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitran</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yranminmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IR</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">compcols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xstyle</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ystyle</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span>
             <span class="n">waveunit_in</span><span class="o">=</span><span class="s1">&#39;micron&#39;</span><span class="p">,</span>
             <span class="n">waveunit_out</span><span class="o">=</span><span class="s1">&#39;micron&#39;</span><span class="p">,</span>
             <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">fluxunit_in</span><span class="o">=</span><span class="s1">&#39;flambda&#39;</span><span class="p">,</span>
             <span class="n">fluxunit_out</span><span class="o">=</span><span class="s1">&#39;flambda&#39;</span><span class="p">,</span>
             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;light&#39;</span>
             <span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Created on Tue Jun  1 13:32:37 2021</span>

<span class="sd">    @author: annamurphree</span>

<span class="sd">    Plots continuum fit of optical data (fit by fitqsohost or ppxf)</span>
<span class="sd">    or IR data (fit by questfit).</span>

<span class="sd">    Init file optional parameters (&#39;argscontplot&#39;):</span>
<span class="sd">        xstyle = log or lin (linear),</span>
<span class="sd">        ystyle = log or lin (linear),</span>
<span class="sd">        waveunit_in = micron or Angstrom,</span>
<span class="sd">        waveunit_out = micron or Angstrom,</span>
<span class="sd">        fluxunit_in = flambda, lambdaflambda (= nufnu), or fnu,</span>
<span class="sd">        fluxunit_out = flambda, lambdaflambda (= nufnu), or fnu,</span>
<span class="sd">        mode = light or dark</span>
<span class="sd">        The first options are the defaults.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># dark mode just for fun:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
        <span class="n">pltstyle</span> <span class="o">=</span> <span class="s1">&#39;dark_background&#39;</span>
        <span class="n">dcolor</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pltstyle</span> <span class="o">=</span> <span class="s1">&#39;seaborn-v0_8-ticks&#39;</span>
        <span class="n">dcolor</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="n">wave</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">wave</span>
    <span class="n">specstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_dat</span>
    <span class="n">modstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_fit</span>

    <span class="c1"># for optical spectra fit by fitqsohost or ppxf:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">IR</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">compspec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compspec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">compspec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ncomp</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">compcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;plum&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]</span>
            <span class="n">complabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;QSO&#39;</span><span class="p">,</span> <span class="s1">&#39;Host&#39;</span><span class="p">,</span> <span class="s1">&#39;Wind&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">comptitles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">complabels</span> <span class="o">=</span> <span class="n">comptitles</span>
            <span class="k">if</span> <span class="n">compcols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compcolors</span> <span class="o">=</span> <span class="n">compcols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ncomp</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">fitran</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xran</span> <span class="o">=</span> <span class="n">fitran</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xran</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">fitrange</span>

        <span class="k">if</span> <span class="n">waveunit_in</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
            <span class="c1"># convert angstrom to microns</span>
            <span class="n">xran</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">xran</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
            <span class="c1"># speed of light in microns/s</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mf">2.998e+14</span>
        <span class="k">elif</span> <span class="n">waveunit_in</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
            <span class="c1"># convert microns to angstroms</span>
            <span class="n">xran</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xran</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
            <span class="c1"># speed of light in angstroms/s</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mf">2.998e+18</span>

        <span class="k">if</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;lambdaflambda&#39;</span><span class="p">:</span>
            <span class="c1"># multiply the flux by wavelength</span>
            <span class="n">specstars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">specstars</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
            <span class="n">modstars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">modstars</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ncomp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
                    <span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">wave</span><span class="p">))</span>
            <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;$\lambda$F$_\lambda$&#39;</span>
        <span class="k">elif</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;fnu&#39;</span><span class="p">:</span>
            <span class="c1"># multiply the flux by wavelength^2/c</span>
            <span class="n">specstars</span> <span class="o">=</span> \
                <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">specstars</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">),</span> <span class="n">c</span><span class="p">)))</span>
            <span class="n">modstars</span> <span class="o">=</span> \
                <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">modstars</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">),</span> <span class="n">c</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">ncomp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
                    <span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">),</span> <span class="n">c</span><span class="p">)))</span>
            <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_</span><span class="se">\u03BD</span><span class="s1">$&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_\lambda$&#39;</span>

        <span class="c1"># plot on a log scale:</span>
        <span class="k">if</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span> <span class="ow">or</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">pltstyle</span><span class="p">)</span>
            <span class="c1"># CB: Otherwise the background becomes black and the axes ticks</span>
            <span class="c1"># unreadable when saving the figure</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;light&#39;</span><span class="p">:</span>
                <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="c1"># fig = plt.figure()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># so the subplots don&#39;t share a y-axis</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="n">specstars</span>
            <span class="n">ymod</span> <span class="o">=</span> <span class="n">modstars</span>
            <span class="c1"># plotting</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># so the subplots don&#39;t share a y-axis</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># so the subplots don&#39;t share a y-axis</span>

            <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
            <span class="c1"># ax1.legend(ncol=2)</span>
            <span class="k">if</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="c1"># ax1.set_xticklabels([])</span>
            <span class="k">if</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ytit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;QSO&#39;</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">10e-7</span><span class="p">)</span>

            <span class="c1"># actually plotting</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ydat</span><span class="p">,</span> <span class="n">dcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ymod</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ncomp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">compcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="n">complabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># tick formatting</span>
            <span class="n">yticks_used</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
            <span class="n">ylim_used</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">yticks_used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ylim_used</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yticks_used</span><span class="p">),</span>
                                    <span class="n">ylim_used</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks_used</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim_used</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>


            <span class="n">l</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">get_texts</span><span class="p">():</span>
                <span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dcolor</span><span class="p">)</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">specstars</span><span class="p">,</span> <span class="n">modstars</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">dcolor</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data/Model&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span>

            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($\AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">savefig</span> <span class="ow">and</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span> <span class="ow">or</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>
            <span class="n">dxran</span> <span class="o">=</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xran1</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
            <span class="n">xran2</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                     <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
            <span class="n">xran3</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                     <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

            <span class="n">i1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">i2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">i3</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">ydat</span> <span class="o">=</span> <span class="n">specstars</span>
            <span class="n">ymod</span> <span class="o">=</span> <span class="n">modstars</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran3</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">maxthresh</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">ntop</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">nbottom</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">ntop</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">nbottom</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="o">++</span><span class="n">ntop</span>
            <span class="o">--</span><span class="n">nbottom</span>

            <span class="k">if</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\mu$m)&#39;</span>
            <span class="k">elif</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\AA$)&#39;</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">pltstyle</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># so the subplots don&#39;t share a y-axis</span>

            <span class="n">maximum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="s1">&#39;&#39;</span>
            <span class="n">idict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">i1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="n">i3</span><span class="p">}</span>
            <span class="n">xrans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">xran1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">xran2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="n">xran3</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>

                    <span class="c1"># finding min/max values at indices from idict</span>
                    <span class="n">dat_et_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ydat</span><span class="p">[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]],</span>
                                                 <span class="n">ymod</span><span class="p">[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]]))</span>
                    <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">dat_et_mod</span><span class="p">)</span>
                    <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">dat_et_mod</span><span class="p">)</span>
                    <span class="c1"># set min and max in yran</span>
                    <span class="k">if</span> <span class="n">yranminmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">]</span>

                    <span class="c1"># finding yran[1] aka max</span>
                    <span class="n">ydi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]))</span>
                    <span class="n">ydi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydat</span><span class="p">)[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]]</span>

                    <span class="n">ymodi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]))</span>
                    <span class="n">ymodi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymod</span><span class="p">)[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydi</span> <span class="o">-</span> <span class="n">ymodi</span><span class="p">)</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

                    <span class="n">iysort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">ysort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">iysort</span><span class="p">]</span>

                    <span class="n">ymodisort</span> <span class="o">=</span> <span class="n">ymodi</span><span class="p">[</span><span class="n">iysort</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ysort</span><span class="p">[</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ysort</span><span class="p">[</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">maxthresh</span><span class="p">:</span>
                        <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ysort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">]</span> <span class="o">+</span>
                                            <span class="n">ymodisort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">])</span>

                    <span class="c1"># plotting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ytit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xtit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

                    <span class="c1"># tick formatting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">0.025</span><span class="p">,</span>
                                           <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.025</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span>
                                           <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">+</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ydat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
                        <span class="c1"># this will fail if fluxes are very low (&lt;~1e-10)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">((</span><span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">5.</span><span class="p">,</span>
                                                   <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">()</span>

                    <span class="c1"># actually plotting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ydat</span><span class="p">,</span> <span class="n">dcolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">ncomp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">compspec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">compcolors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">complabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ymod</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

            <span class="c1"># more formatting</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
            <span class="c1">#plt.tight_layout(pad=5)</span>
            <span class="c1">#plt.gcf().subplots_adjust(bottom=0.1)</span>

            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">savefig</span> <span class="ow">and</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>

    <span class="c1"># for IR spectra fit with questfit:</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">comp_best_fit</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">ct_coeff</span><span class="p">[</span><span class="s1">&#39;comp_best_fit&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span> <span class="ow">or</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">IR</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>

                <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="n">wave</span> <span class="c1">#[q3do.ct_indx]</span>
                <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span> <span class="c1">#[q3do.ct_indx]</span>
                <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="n">modstars</span> <span class="c1">#[q3do.ct_indx]</span>

                <span class="k">if</span> <span class="n">waveunit_in</span> <span class="o">==</span><span class="s1">&#39;micron&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                    <span class="c1"># convert microns to angstroms</span>
                    <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">waveunit_in</span> <span class="o">==</span><span class="s1">&#39;Angstrom&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                    <span class="c1"># convert angstroms to microns</span>
                    <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;lambdaflambda&#39;</span><span class="p">:</span>
                    <span class="c1"># multiply the flux by wavelength</span>
                    <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                    <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                            <span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
                                <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]],</span>
                                            <span class="n">MIRgdlambda</span><span class="p">)</span>
                    <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;$\lambda$F$_\lambda$&#39;</span>
                <span class="k">elif</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;fnu&#39;</span><span class="p">:</span>
                    <span class="c1"># multiply the flux by wavelength^2/c</span>
                    <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                    <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                    <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_</span><span class="se">\u03BD</span><span class="s1">$&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_\lambda$&#39;</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">pltstyle</span><span class="p">)</span>

                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">dcolor</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;global_ext_model&#39;</span> <span class="ow">in</span> <span class="n">q3di</span><span class="o">.</span><span class="n">argscontfit</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]],</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span>
                                                         <span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])),</span>
                                 <span class="n">label</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">],</span>
                                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]],</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span>
                                                         <span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]])),</span>
                                 <span class="n">label</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">],</span>
                                 <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">comp_i</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;ext&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_i</span> <span class="ow">and</span> <span class="s1">&#39;abs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_i</span><span class="p">:</span>
                                <span class="n">spec_out</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">spec_out</span> <span class="o">*=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">spec_out</span> <span class="o">*=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span><span class="p">]</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">spec_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">comp_i</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


                <span class="c1">#ax1.legend(ncol=2)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ytit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

                <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span><span class="n">MIRcontinuum</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">dcolor</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data/Model&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($\AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">xstyle</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span> <span class="ow">or</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">fitran</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xran</span> <span class="o">=</span> <span class="n">fitran</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xran</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">fitran</span>


            <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="n">wave</span> <span class="c1">#[q3do.ct_indx]</span>
            <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span> <span class="c1">#[q3do.ct_indx]</span>
            <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="n">modstars</span> <span class="c1">#[q3do.ct_indx]</span>

            <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">waveunit_in</span> <span class="o">==</span> <span class="s1">&#39;microns&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                <span class="c1"># convert wave list from microns to angstroms</span>
                <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
                <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\AA$)&#39;</span>
            <span class="k">elif</span> <span class="n">waveunit_in</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span> <span class="ow">and</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                <span class="c1"># convert wave list from angstroms to microns</span>
                <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
                <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\mu$m)&#39;</span>

            <span class="k">if</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;lambdaflambda&#39;</span><span class="p">:</span>
                <span class="c1"># multiply the flux by wavelength</span>
                <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                        <span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> \
                            <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]],</span>
                                             <span class="n">MIRgdlambda</span><span class="p">))</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;$\lambda$F$_\lambda$&#39;</span>
            <span class="k">elif</span> <span class="n">fluxunit_in</span> <span class="o">==</span> <span class="s1">&#39;flambda&#39;</span> <span class="ow">and</span> <span class="n">fluxunit_out</span> <span class="o">==</span> <span class="s1">&#39;fnu&#39;</span><span class="p">:</span>
                <span class="c1"># multiply the flux by wavelength</span>
                <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRgdlambda</span><span class="p">))</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_</span><span class="se">\u03BD</span><span class="s1">$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;F$_\lambda$&#39;</span>

            <span class="n">wave</span> <span class="o">=</span> <span class="n">MIRgdlambda</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="n">MIRgdflux</span>
            <span class="n">ymod</span> <span class="o">=</span> <span class="n">MIRcontinuum</span>

            <span class="n">dxran</span> <span class="o">=</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xran1</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">xran2</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">xran3</span> <span class="o">=</span> <span class="p">[</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dxran</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

            <span class="n">i1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">i2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">i3</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran3</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">i3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">maxthresh</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">ntop</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="n">nbottom</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">ntop</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">nbottom</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="o">++</span><span class="n">ntop</span>
            <span class="o">--</span><span class="n">nbottom</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">pltstyle</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="c1">#fig = plt.figure()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># so the subplots don&#39;t share a y-axis</span>

            <span class="n">maximum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">idict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="n">i1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="n">i2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="n">i3</span><span class="p">}</span>
            <span class="n">xrans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="n">xran1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="n">xran2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="n">xran3</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
                    <span class="c1"># shrink current axis by 10% to fit legend on side</span>
                    <span class="n">box</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">box</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span><span class="p">])</span>
                    <span class="c1"># finding max value between ydat and ymod at indices from i1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
                        <span class="n">bigboy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">ydat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ymod</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                        <span class="k">if</span> <span class="n">bigboy</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="p">:</span>
                            <span class="n">maximum</span> <span class="o">=</span> <span class="n">bigboy</span>
                    <span class="c1"># finding min</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
                        <span class="n">smallboy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">ydat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ymod</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                        <span class="k">if</span> <span class="n">smallboy</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">:</span>
                            <span class="n">minimum</span> <span class="o">=</span> <span class="n">smallboy</span>
                    <span class="c1"># set min and max in yran</span>
                    <span class="k">if</span> <span class="n">yranminmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum</span><span class="p">]</span>

                    <span class="c1"># finding yran[1] aka max</span>
                    <span class="n">ydi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]))</span>
                    <span class="n">ydi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydat</span><span class="p">)[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]]</span>

                    <span class="n">ymodi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]))</span>
                    <span class="n">ymodi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ymod</span><span class="p">)[</span><span class="n">idict</span><span class="p">[</span><span class="n">group</span><span class="p">]]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ydi</span> <span class="o">-</span> <span class="n">ymodi</span><span class="p">)</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

                    <span class="n">iysort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">ysort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">iysort</span><span class="p">]</span>

                    <span class="n">ymodisort</span> <span class="o">=</span> <span class="n">ymodi</span><span class="p">[</span><span class="n">iysort</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ysort</span><span class="p">[</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ysort</span><span class="p">[</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">maxthresh</span><span class="p">:</span>
                        <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ysort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">]</span> <span class="o">+</span>
                                            <span class="n">ymodisort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ny</span> <span class="o">-</span> <span class="n">ntop</span><span class="p">])</span>

                    <span class="c1"># plotting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ytit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xtit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ystyle</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

                    <span class="c1"># tick formatting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;micron&#39;</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">waveunit_out</span> <span class="o">==</span> <span class="s1">&#39;Angstrom&#39;</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
                                           <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">xrans</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">+</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fluxunit_out</span> <span class="o">!=</span> <span class="s1">&#39;fnu&#39;</span><span class="p">:</span>
                        <span class="c1"># this will fail if fluxes are very low (&lt;~1e-10)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">((</span><span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">5.</span><span class="p">,</span>
                                                       <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
                                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">()</span>

                    <span class="c1"># actually plotting</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">dcolor</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="s1">&#39;global_ext_model&#39;</span> <span class="ow">in</span> <span class="n">q3di</span><span class="o">.</span><span class="n">argscontfit</span><span class="p">:</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                              <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]],</span>
                                                   <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span>
                                                               <span class="n">comp_best_fit</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])),</span>
                                       <span class="n">label</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">comp_i</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;ext&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_i</span> <span class="ow">and</span> <span class="s1">&#39;abs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp_i</span><span class="p">:</span>
                                <span class="n">spec_out</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">spec_out</span> <span class="o">*=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">spec_out</span> <span class="o">*=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">comp_i</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span><span class="p">]</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">spec_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">comp_i</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


                    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.22</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>

        <span class="c1"># more formatting</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">savefig</span> <span class="ow">and</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="plotline">
<a class="viewcode-back" href="../../source/q3dfit.html#q3dfit.plot.plotline">[docs]</a>
<span class="k">def</span> <span class="nf">plotline</span><span class="p">(</span><span class="n">q3do</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">center_rest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">300.</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">specConv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Plot emission line fit and output to JPG</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q3do : dict</span>
<span class="sd">       contains results of fit</span>
<span class="sd">    label=np.arrange(Nlines)</span>
<span class="sd">        label= str(label)</span>
<span class="sd">        line labels for plot</span>
<span class="sd">        wave= np.arrange((Nlines), float)</span>
<span class="sd">        rest wavelengths of lines</span>
<span class="sd">        lineoth= np.arrange((Notherlines, Ncomp), float)</span>
<span class="sd">        wavelengths of other lines to plot</span>
<span class="sd">        nx # of plot columns</span>
<span class="sd">        ny # of plot rows</span>
<span class="sd">    outfile : str</span>
<span class="sd">        Full path and name of output plot.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ncomp</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">maxncomp</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="s1">&#39;Orange&#39;</span><span class="p">,</span> <span class="s1">&#39;Teal&#39;</span><span class="p">]</span>

    <span class="n">wave</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">wave</span>
    <span class="n">spectot</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span>
    <span class="n">specstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_dat</span>
    <span class="n">modstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_fit</span>
    <span class="n">modlines</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">line_fit</span>
    <span class="n">modtot</span> <span class="o">=</span> <span class="n">modstars</span> <span class="o">+</span> <span class="n">modlines</span>

    <span class="c1"># To-do: Allow output wavelengths in Angstrom</span>
    <span class="c1">#&#39;waveunit_out&#39; = &#39;micron&#39;</span>
    <span class="c1"># if &#39;waveunit_out&#39; in pltpar:</span>
    <span class="c1">#     if pltpar[&#39;waveunit_out = &#39;Angstrom&#39;:</span>
    <span class="c1">#         waveunit_out = &#39;Angstrom&#39;</span>

    <span class="c1"># To-do: Get masking code from pltcont</span>

    <span class="c1"># lines</span>
    <span class="n">linelist</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span>
    <span class="n">linelabel</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">linetext</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;linelab&#39;</span><span class="p">]</span>
    <span class="c1"># Sort in wavelength order</span>
    <span class="n">isortlam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">linelist</span><span class="p">)</span>
    <span class="n">linelist</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="n">isortlam</span><span class="p">]</span>
    <span class="n">linelabel</span> <span class="o">=</span> <span class="n">linelabel</span><span class="p">[</span><span class="n">isortlam</span><span class="p">]</span>
    <span class="n">linetext</span> <span class="o">=</span> <span class="n">linetext</span><span class="p">[</span><span class="n">isortlam</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="c1"># Plotting parameters</span>
    <span class="c1">#</span>
    <span class="c1"># Look for line list, then determine center of plot window from fitted</span>
    <span class="c1"># wavelength</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sub_linlab</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">linwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_linlab</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_linlab</span><span class="p">)):</span>
            <span class="c1"># Get wavelength from zeroth component</span>
            <span class="k">if</span> <span class="n">sub_linlab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">lmline</span> <span class="o">=</span> <span class="n">lmlabel</span><span class="p">(</span><span class="n">sub_linlab</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="c1"># if ncomp &gt; 0</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lmline</span><span class="o">.</span><span class="n">lmlabel</span><span class="si">}</span><span class="s1">_0_cwv&#39;</span> <span class="ow">in</span> <span class="n">q3do</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">linwav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lmline</span><span class="o">.</span><span class="n">lmlabel</span><span class="si">}</span><span class="s1">_0_cwv&#39;</span><span class="p">]</span>
                <span class="c1"># otherwise</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_linlab</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">linwav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">q3do</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linwav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c1"># If linelist not present, get cwavelength enter of plot window from list</span>
    <span class="c1"># first option: wavelength center specified in observed (plotted) frame</span>
    <span class="k">elif</span> <span class="n">center_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">center_obs</span><span class="p">)</span>
    <span class="c1"># second option: wavelength center specified in rest frame, then converted</span>
    <span class="c1"># to observed (plotted) frame</span>
    <span class="k">elif</span> <span class="n">center_rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">center_rest</span><span class="p">)</span> <span class="o">*</span> <span class="n">q3do</span><span class="o">.</span><span class="n">zstar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InitializationError</span><span class="p">(</span><span class="s1">&#39;LINE, CENTER_OBS, or CENTER_REST &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;list not given in ARGSPLTLIN dictionary&#39;</span><span class="p">)</span>
    <span class="n">nlin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linwav</span><span class="p">)</span>
    <span class="c1"># Size of plot in wavelength, in observed frame</span>
    <span class="c1"># case of single size for all panels</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">nlin</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>  <span class="c1"># default size currently 300 A ... fix for</span>
    <span class="c1"># case of array of sizes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># other units!</span>
    <span class="n">off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="n">size</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">size</span><span class="o">/</span><span class="mf">2.</span><span class="p">])</span>
    <span class="n">off</span> <span class="o">=</span> <span class="n">off</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlin</span><span class="p">):</span>

        <span class="n">outer</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">inner</span> <span class="o">=</span> \
            <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                             <span class="n">subplot_spec</span><span class="o">=</span><span class="n">outer</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                             <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                             <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                             <span class="n">width_ratios</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># create xran and ind</span>
        <span class="n">linwavtmp</span> <span class="o">=</span> <span class="n">linwav</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">offtmp</span> <span class="o">=</span> <span class="n">off</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">xran</span> <span class="o">=</span> <span class="n">linwavtmp</span> <span class="o">+</span> <span class="n">offtmp</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">wave</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">wave</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ct</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># create subplots</span>
            <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">inner</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">inner</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax0</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="c1"># create x-ticks</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># if waveunit_out == &#39;Angstrom&#39;:</span>
            <span class="c1">#     xticks = xticks * 1.E4</span>
            <span class="c1"># create minor x-ticks</span>
            <span class="n">xmticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">xmticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xmticks</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># if waveunit_out == &#39;Angstrom&#39;:</span>
            <span class="c1">#     xmticks = xticks * 1.E4</span>
            <span class="c1"># set ticks</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xmticks</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xmticks</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

            <span class="c1"># create yran</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="n">spectot</span>
            <span class="n">ymod</span> <span class="o">=</span> <span class="n">modtot</span>
            <span class="n">ydattmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ct</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">ymodtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ct</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                <span class="n">ydattmp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydat</span><span class="p">[(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
                <span class="n">ymodtmp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymod</span><span class="p">[(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
            <span class="n">ydatmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ydattmp</span><span class="p">)</span>
            <span class="n">ymodmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymodtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ydatmin</span> <span class="o">&lt;=</span> <span class="n">ymodmin</span><span class="p">:</span>
                <span class="n">yranmin</span> <span class="o">=</span> <span class="n">ydatmin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yranmin</span> <span class="o">=</span> <span class="n">ymodmin</span>
            <span class="n">ydatmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ydattmp</span><span class="p">)</span>
            <span class="n">ymodmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymodtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ydatmax</span> <span class="o">&gt;=</span> <span class="n">ymodmax</span><span class="p">:</span>
                <span class="n">yranmax</span> <span class="o">=</span> <span class="n">ydatmax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yranmax</span> <span class="o">=</span> <span class="n">ymodmax</span>
            <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="n">yranmin</span><span class="p">,</span> <span class="n">yranmax</span><span class="p">]</span>
            <span class="n">icol</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">icol</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;Fit&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="n">ytit</span><span class="p">)</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="c1"># plots on ax0</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ydat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\mu$m)&#39;</span>
            <span class="c1"># if waveunit_out == &#39;Angstrom&#39;:</span>
            <span class="c1">#     xtit = &#39;Observed Wavelength ($\AA$)&#39;</span>
            <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ymod</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Plot all lines visible in plot range</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncomp</span><span class="p">):</span>
                <span class="n">ylaboff</span> <span class="o">=</span> <span class="mf">0.07</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">linelabel</span><span class="p">):</span>
                    <span class="n">lmline</span> <span class="o">=</span> <span class="n">lmlabel</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lmline</span><span class="o">.</span><span class="n">lmlabel</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_cwv&#39;</span> <span class="ow">in</span> <span class="n">q3do</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">refwav</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lmline</span><span class="o">.</span><span class="n">lmlabel</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_cwv&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">irefwav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">line</span><span class="p">)</span>
                        <span class="n">refwav</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">][</span><span class="n">irefwav</span><span class="p">]</span> <span class="o">*</span> \
                            <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">q3do</span><span class="o">.</span><span class="n">zstar</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">refwav</span> <span class="o">&gt;=</span> <span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">refwav</span> <span class="o">&lt;=</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">lmline</span><span class="o">.</span><span class="n">lmlabel</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_cwv&#39;</span> <span class="ow">in</span> \
                            <span class="n">q3do</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">flux</span> <span class="o">=</span> <span class="n">cmplin</span><span class="p">(</span><span class="n">q3do</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">velsig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">specConv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">conv</span> <span class="o">=</span> <span class="n">specConv</span><span class="o">.</span><span class="n">spect_convolver</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">refwav</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">conv</span> <span class="o">=</span> <span class="n">flux</span>
                            <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">conv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                                     <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                        <span class="n">ax0</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">linetext</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">ylaboff</span><span class="p">),</span>
                                     <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                                     <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                        <span class="n">ylaboff</span> <span class="o">+=</span> <span class="mf">0.07</span>

        <span class="c1"># if nmasked &gt; 0:</span>
        <span class="c1">#   for r in range(0,nmasked):</span>
        <span class="c1">#        ax0.plot([masklam[r,0], masklam[r,1]], [yran[0], yran[0]],linewidth=8, color=&#39;Cyan&#39;)</span>
            <span class="c1"># set new value for yran</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="n">specstars</span>
            <span class="n">ymod</span> <span class="o">=</span> <span class="n">modstars</span>
            <span class="n">ydattmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">ymodtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                <span class="n">ydattmp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydat</span><span class="p">[(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
                <span class="n">ymodtmp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymod</span><span class="p">[(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
            <span class="n">ydatmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ydattmp</span><span class="p">)</span>
            <span class="n">ymodmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymodtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ydatmin</span> <span class="o">&lt;=</span> <span class="n">ymodmin</span><span class="p">:</span>
                <span class="n">yranmin</span> <span class="o">=</span> <span class="n">ydatmin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yranmin</span> <span class="o">=</span> <span class="n">ymodmin</span>
            <span class="n">ydatmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ydattmp</span><span class="p">)</span>
            <span class="n">ymodmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymodtmp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ydatmax</span> <span class="o">&gt;=</span> <span class="n">ymodmax</span><span class="p">:</span>
                <span class="n">yranmax</span> <span class="o">=</span> <span class="n">ydatmax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yranmax</span> <span class="o">=</span> <span class="n">ymodmax</span>
            <span class="n">yran</span> <span class="o">=</span> <span class="p">[</span><span class="n">yranmin</span><span class="p">,</span> <span class="n">yranmax</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">icol</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;Residual&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ytit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="n">ytit</span><span class="p">)</span>
            <span class="c1"># plots on ax1</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xran</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">yran</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">yran</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ydat</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">ymod</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">)</span>

    <span class="c1"># title</span>
    <span class="n">xtit</span> <span class="o">=</span> <span class="s1">&#39;Observed Wavelength ($\mu$m)&#39;</span>
    <span class="c1"># if waveunit_out == &#39;Angstrom&#39;:</span>
    <span class="c1">#     xtit = &#39;Observed Wavelength ($\AA$)&#39;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">xtit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">and</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="adjust_ax">
<a class="viewcode-back" href="../../source/q3dfit.html#q3dfit.plot.adjust_ax">[docs]</a>
<span class="k">def</span> <span class="nf">adjust_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;CB: Function defined to adjust the sizes of xlabel, ylabel, and the ticklabels (in an inelegant way for the latter)</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----</span>
<span class="sd">        ax: matplotlib axis object</span>
<span class="sd">        ax object of the plot you want to adjust</span>

<span class="sd">        fig: matplotlib fig object</span>
<span class="sd">        fig object that contains the ax object</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        Nothing</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># -- Trying to prune xtickslabels if increasing the fontsize made them overlap</span>
        <span class="n">xticks_old</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minor</span><span class="p">:</span>
            <span class="n">xticks_old</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">xfigsize</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>                <span class="c1"># in inches</span>
        <span class="n">textstrlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">mathdefault&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>    <span class="c1"># length of tick labels depends on nr of decimals specified</span>
        <span class="n">textwidth_inch</span> <span class="o">=</span> <span class="n">textstrlen</span> <span class="o">*</span> <span class="p">(</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.7</span> <span class="o">/</span> <span class="mf">72.</span>    <span class="c1"># Assume width of number in text = 0.7* height. Matplotlib uses 72 Points per inch (ppi): https://stackoverflow.com/questions/47633546/relationship-between-dpi-and-figure-size</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xticks_old</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">textwidth_inch</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="o">*</span> <span class="n">xfigsize</span> <span class="o">*</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="n">xticks_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xticks_old</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">xticks_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xticks_new</span><span class="p">,</span> <span class="n">xticks_old</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">minor</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_new</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_new</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>



<div class="viewcode-block" id="plotdecomp">
<a class="viewcode-back" href="../../source/q3dfit.html#q3dfit.plot.plotdecomp">[docs]</a>
<span class="k">def</span> <span class="nf">plotdecomp</span><span class="p">(</span><span class="n">q3do</span><span class="p">,</span> <span class="n">q3di</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">templ_mask</span><span class="o">=</span><span class="p">[],</span> <span class="n">do_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">try_adjust_ax</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">wave</span>
    <span class="n">specstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_dat</span>
    <span class="n">modstars</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_fit</span>
    <span class="n">MIRgdlambda</span> <span class="o">=</span> <span class="n">wave</span>
    <span class="n">MIRgdflux</span> <span class="o">=</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span>
    <span class="n">MIRcontinuum</span> <span class="o">=</span> <span class="n">modstars</span>

    <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outfile</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">filelab</span> <span class="o">+</span> <span class="s1">&#39;_decomp&#39;</span>

    <span class="k">if</span> <span class="n">do_lines</span><span class="p">:</span>
        <span class="n">plotquest</span><span class="p">(</span><span class="n">q3do</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_fit</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">ct_coeff</span><span class="p">,</span> <span class="n">q3di</span><span class="p">,</span> <span class="n">zstar</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="n">savefig</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> 
            <span class="n">templ_mask</span><span class="o">=</span><span class="n">templ_mask</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">linelist</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">],</span> <span class="n">linespec</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">line_fit</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> 
            <span class="n">try_adjust_ax</span><span class="o">=</span><span class="n">try_adjust_ax</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotquest</span><span class="p">(</span><span class="n">q3do</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">cont_fit</span><span class="p">,</span> <span class="n">q3do</span><span class="o">.</span><span class="n">ct_coeff</span><span class="p">,</span> <span class="n">q3di</span><span class="p">,</span> <span class="n">zstar</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">zstar</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="n">savefig</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> 
            <span class="n">templ_mask</span><span class="o">=</span><span class="n">templ_mask</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">try_adjust_ax</span><span class="o">=</span><span class="n">try_adjust_ax</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">q3do</span><span class="o">.</span><span class="n">col</span><span class="p">)</span></div>




<div class="viewcode-block" id="plotquest">
<a class="viewcode-back" href="../../source/q3dfit.html#q3dfit.plot.plotquest">[docs]</a>
<span class="k">def</span> <span class="nf">plotquest</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRgdflux</span><span class="p">,</span> <span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">ct_coeff</span><span class="p">,</span> <span class="n">q3di</span><span class="p">,</span> <span class="n">zstar</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
            <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">templ_mask</span><span class="o">=</span><span class="p">[],</span> <span class="n">lines</span><span class="o">=</span><span class="p">[],</span> <span class="n">linespec</span><span class="o">=</span><span class="p">[],</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">try_adjust_ax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">row</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

    <span class="c1"># dark mode just for fun:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
        <span class="n">pltstyle</span> <span class="o">=</span> <span class="s1">&#39;dark_background&#39;</span>
        <span class="n">dcolor</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pltstyle</span> <span class="o">=</span> <span class="s1">&#39;seaborn-v0_8-ticks&#39;</span>
        <span class="n">dcolor</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">pltstyle</span><span class="p">)</span>
    <span class="c1"># CB: Otherwise the background becomes black and the axes ticks</span>
    <span class="c1"># unreadable when saving the figure</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;light&#39;</span><span class="p">:</span>
        <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

    <span class="n">comp_best_fit</span> <span class="o">=</span> <span class="n">ct_coeff</span><span class="p">[</span><span class="s1">&#39;comp_best_fit&#39;</span><span class="p">]</span>


    <span class="n">plot_noext</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Remove dust contribution and plot intrinstic components</span>

    <span class="k">if</span> <span class="s1">&#39;plot_decomp&#39;</span> <span class="ow">in</span> <span class="n">q3di</span><span class="o">.</span><span class="n">argscontfit</span><span class="p">:</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">readcf</span><span class="p">(</span><span class="n">q3di</span><span class="o">.</span><span class="n">argscontfit</span><span class="p">[</span><span class="s1">&#39;config_file&#39;</span><span class="p">])</span>
        <span class="n">global_extinction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_file</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;global&#39;</span> <span class="ow">in</span> <span class="n">config_file</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">3</span><span class="p">]:</span>
                        <span class="n">global_extinction</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRgdflux</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRcontinuum</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">MIRcontinuum</span> <span class="o">+</span> <span class="n">linespec</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">templ_mask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">MIRgdlambda_temp</span> <span class="o">=</span> <span class="n">MIRgdlambda</span><span class="p">[</span><span class="n">templ_mask</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">MIRgdlambda_temp</span> <span class="o">=</span> <span class="n">MIRgdlambda</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line_i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
              <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">line_i</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zstar</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1">#ax1.axvspan(line_i-max(q3di.siglim_gas), line_i+max(q3di.siglim_gas))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span> <span class="n">linespec</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>


        <span class="n">colour_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumblue&#39;</span><span class="p">,</span> <span class="s1">&#39;salmon&#39;</span><span class="p">,</span> <span class="s1">&#39;palegreen&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;forestgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;darkgoldenrod&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumblue&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;plum&#39;</span><span class="p">,</span> <span class="s1">&#39;yellowgreen&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">global_extinction</span><span class="p">:</span>
            <span class="n">str_global_ext</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">str_global_ice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># global_ext is a multi-dimensional array</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ext</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ext</span><span class="p">]</span> <span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># global_ice is a multi-dimensional array</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ice</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ice</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ice</span><span class="p">]</span> <span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">el</span> <span class="o">!=</span> <span class="n">str_global_ext</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">el</span> <span class="o">!=</span> <span class="n">str_global_ice</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>              <span class="c1"># component is a multi-dimensional array</span>
                        <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">plot_noext</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">count</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">colour_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">/</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ext</span><span class="p">]</span><span class="o">/</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ice</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">el</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">/</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ext</span><span class="p">]</span><span class="o">/</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">str_global_ice</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_list</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">el</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">count</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">colour_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">el</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_list</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">el</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                  <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;_ext&#39;</span> <span class="ow">in</span> <span class="n">el</span> <span class="ow">or</span> <span class="s1">&#39;_abs&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="p">):</span>
                    <span class="n">spec_i</span> <span class="o">=</span> <span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
                    <span class="n">label_i</span> <span class="o">=</span> <span class="n">el</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_noext</span><span class="p">:</span>
                      <span class="k">if</span> <span class="n">el</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                          <span class="n">spec_i</span> <span class="o">=</span> <span class="n">spec_i</span><span class="o">*</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;_ext&#39;</span><span class="p">]</span>
                      <span class="k">if</span> <span class="n">el</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span> <span class="ow">in</span> <span class="n">comp_best_fit</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                          <span class="n">spec_i</span> <span class="o">=</span> <span class="n">spec_i</span><span class="o">*</span><span class="n">comp_best_fit</span><span class="p">[</span><span class="n">el</span><span class="o">+</span><span class="s1">&#39;_abs&#39;</span><span class="p">]</span>


                    <span class="k">if</span> <span class="n">count</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">colour_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                      <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">spec_i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_i</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                      <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda_temp</span><span class="p">,</span> <span class="n">spec_i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>


        <span class="c1">#ax1.set_ylim(1e-5,1e2)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">try_adjust_ax</span><span class="p">:</span>
            <span class="n">adjust_ax</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># turn off major &amp; minor ticks on the x-axis</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">MIRcontinuum</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">MIRcontinuum</span> <span class="o">+</span> <span class="n">linespec</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span><span class="n">MIRgdflux</span><span class="o">/</span><span class="p">(</span><span class="n">MIRcontinuum</span> <span class="o">+</span> <span class="n">linespec</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">MIRcontinuum</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">MIRgdflux</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">MIRcontinuum</span><span class="p">)))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MIRgdlambda</span><span class="p">,</span><span class="n">MIRgdflux</span><span class="o">/</span><span class="n">MIRcontinuum</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ymin</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">ymin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ymax</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data/Model&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [micron]&#39;</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">ScalarFormatter</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">row</span><span class="o">&gt;-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">col</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spaxel [</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">adjust_ax</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">savefig</span> <span class="ow">and</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="o">+</span><span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, David Rupke and the Q3D Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>